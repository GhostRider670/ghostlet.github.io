<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Settings</title>

<!-- Main Theme From Stats Page -->
<style>
  :root {
    --glow: #ff6aff;
    --bgTop: #242444;
    --bgMain: #0d0d1a;
    --textLight: #eee;
    --textDim: #bbb;
  }

  body {
    margin: 0;
    font-family: Segoe UI, Arial, sans-serif;
    background: linear-gradient(180deg, var(--bgMain), #1a1a2e);
    color: var(--textLight);
    overflow-x: hidden;
  }

  /* Top Bar */
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bgTop);
    padding: 10px 16px;
    border-bottom: 2px solid var(--glow);
    box-shadow: 0 0 10px var(--glow);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .brand {
    font-weight: 800;
    color: var(--glow);
    text-decoration: none;
  }

  .navBtns button {
    background: var(--glow);
    border: none;
    padding: 6px 10px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    margin-left: 4px;
    font-size: 0.85rem;
  }

  /* Page Container */
  .container {
    max-width: 480px;
    margin: 20px auto;
    padding: 0 20px;
  }

  h1 {
    text-align: center;
    color: var(--glow);
  }

  label {
    display: block;
    margin-top: 15px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--textDim);
  }

  input {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    border: none;
    margin-top: 6px;
    background: #2b2b44;
    color: var(--textLight);
    font-size: 1rem;
  }

  button.saveBtn {
    width: 100%;
    background: var(--glow);
    border: none;
    padding: 12px;
    margin-top: 20px;
    border-radius: 10px;
    color: #fff;
    cursor: pointer;
    font-size: 1rem;
  }

  .status {
    text-align: center;
    margin-top: 10px;
    font-size: 0.9rem;
  }
</style>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <a class="brand" href="stats.html">Ghostlet</a>
  <div class="navBtns">
    <button onclick="window.location='stats.html'">Stats</button>
    <button onclick="window.location='blooks.html'">Blooks</button>
    <button onclick="window.location='settings.html'">Settings</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">
  <h1>Settings</h1>

  <label>Change Username</label>
  <input id="usernameInput" type="text" placeholder="New Username">

  <button class="saveBtn" onclick="saveSettings()">Save</button>

  <div class="status" id="statusMessage"></div>
</div>

<script>
  const supabase = supabase.createClient(
    "https://bjgxufxgpgojkwqbdyqp.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqZ3h1ZnhncGdvamt3cWJkeXFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTk1NjMsImV4cCI6MjA3ODk3NTU2M30.BRyjh8E2WK1KTquDhzfBtAmcBuxhZ4jRsZQgN_5s9rg"
  );

  // Load current username
  document.addEventListener("DOMContentLoaded", async () => {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return window.location = "login.html";

    const { data } = await supabase
      .from("profiles")
      .select("username")
      .eq("id", user.id)
      .single();

    if (data?.username) {
      document.getElementById("usernameInput").value = data.username;
    }
  });

  // Save username
  async function saveSettings() {
    const newName = document.getElementById("usernameInput").value.trim();
    const status = document.getElementById("statusMessage");

    if (!newName) {
      status.textContent = "Username cannot be empty.";
      return;
    }

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { error } = await supabase
      .from("profiles")
      .update({ username: newName })
      .eq("id", user.id);

    if (error) {
      status.textContent = "Error saving settings.";
    } else {
      status.textContent = "Saved!";
    }
  }

  // Logout
  async function logout() {
    await supabase.auth.signOut();
    window.location = "login.html";
  }
</script>

</body>
</html>
